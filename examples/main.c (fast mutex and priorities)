#include <stm32f4_discovery.h>
#include <os.h>

OS_MUT(mut);
OS_TSK(mas, 2, master);
OS_TSK(sla, 1, slave);

void master()
{
	mut_wait(mut);
	mut_give(mut);

	LEDG = 1;
	for (;;); // BREAKPOINT: 1 (priority inheritance mutex)
}

void slave()
{
	tsk_start(mas);

	LEDR = 1;
	for (;;); // BREAKPOINT: 2 (fast mutex)
}

int main()
{
	LED_Init();
	
	mut_wait(mut);
	tsk_start(sla);
	mut_give(mut);

	LEDB = 1;
	for (;;); // BREAKPOINT: 3 (cooperative kernel)
}
