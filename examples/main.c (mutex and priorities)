#include <stm32f4_discovery.h>
#include <os.h>

OS_MTX(mtx);
OS_TSK(mas, 2, master);
OS_TSK(sla, 1, slave);

void master()
{
	mtx_wait(mtx);
	mtx_give(mtx);

	LEDG = 1;
	for (;;); // BREAKPOINT: 1 (priority inheritance mutex)
}

void slave()
{
	tsk_start(mas);

	LEDR = 1;
	for (;;); // BREAKPOINT: 2 (fast mutex)
}

int main()
{
	LED_Config();
	
	mtx_wait(mtx);
	tsk_start(sla);
	mtx_give(mtx);

	LEDB = 1;
	for (;;); // BREAKPOINT: 3 (cooperative kernel)
}
