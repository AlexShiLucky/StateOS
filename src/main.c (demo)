#include <stm32f4_discovery.h>
#include <os.h>

// NOTE: in makefile add 'proc_stack_size=2048' to DEFS

volatile
unsigned *l[] = { &LED[0],  &LED[1],  &LED[2],  &LED[3],  &GRN };
unsigned  t[] = { 500*MSEC, 625*MSEC, 750*MSEC, 875*MSEC, 1000*MSEC };

void proc()
{
	static
	unsigned i = 0;
	unsigned n = i++;
	unsigned d = t[n];

	for (;;)
	{
		tsk_sleepUntil(d);
		d += SEC/2;
		l[n][0]++;
	}
}

int main()
{
    LED_Config();
    GRN_Config();
	
	tsk_start(TSK_CREATE(0, proc));
	tsk_start(TSK_CREATE(0, proc));
	tsk_start(TSK_CREATE(0, proc));
	tsk_start(TSK_CREATE(0, proc));
	tsk_start(TSK_CREATE(0, proc));
	
	tsk_stop();
}
